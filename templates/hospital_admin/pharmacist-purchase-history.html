{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0" />
  <title>Purchase History</title>
  <link rel="stylesheet" href="{% static 'HealthStack-System/css/Normal/bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'HealthStack-System/plugins/Normal/fontawesome/css/all.min.css' %}">
  <link rel="stylesheet" href="{% static 'HealthStack-System/css/admin/style.css'%}" />
</head>
<body>
<div class="main-wrapper">
  <header class="header">{% include 'hospital_admin/pharmacist-navbar.html' %}</header>
  <aside class="sidebar" id="sidebar">{% include 'hospital_admin/pharmacist-sidebar.html' %}</aside>
  <div class="page-wrapper">
    <div class="content container-fluid">
      <div class="page-header"><h3 class="page-title">Purchase History</h3></div>

      <!-- Completed Orders -->
      <div class="card">
        <div class="card-header">
          <h4 class="card-title">Completed Orders</h4>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Order ID</th>
                  <th>Patient</th>
                  <th>Items</th>
                  <th>Total</th>
                  <th>Delivery Method</th>
                  <th>Status</th>
                  <th>Order Date</th>
                </tr>
              </thead>
              <tbody>
                {% for order in completed_orders %}
                <tr>
                  <td>#{{ order.id }}</td>
                  <td>{{ order.user.patient.name }}</td>
                  <td>
                    {% for item in order.orderitems.all %}
                      <div class="medicine-item">
                        <strong>{{ item.item.name }}</strong> x{{ item.quantity }}
                      </div>
                    {% endfor %}
                  </td>
                  <td>₹{{ order.final_bill }}</td>
                  <td>
                    <span class="badge badge-{% if order.delivery_method == 'delivery' %}primary{% else %}secondary{% endif %}">
                      {{ order.get_delivery_method_display }}
                    </span>
                  </td>
                  <td>
                    <span class="badge badge-success">{{ order.get_order_status_display }}</span>
                  </td>
                  <td>{{ order.created|date:"M d, Y H:i" }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="7" class="text-center text-muted">No completed orders yet.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Individual Purchase Items (Legacy) -->
      <div class="card mt-4">
        <div class="card-header">
          <h4 class="card-title">Individual Purchase Items</h4>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>#</th>
                  <th>User</th>
                  <th>Medicine</th>
                  <th>Quantity</th>
                  <th>Price</th>
                  <th>Total</th>
                  <th>Purchased At</th>
                </tr>
              </thead>
              <tbody>
                {% for c in purchased_items %}
                <tr>
                  <td>{{ forloop.counter }}</td>
                  <td>{{ c.user.username }}</td>
                  <td>{{ c.item.name }}</td>
                  <td>{{ c.quantity }}</td>
                  <td>₹{{ c.item.price }}</td>
                  <td>₹{{ c.get_total }}</td>
                  <td>{{ c.updated }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="7" class="text-center text-muted">No individual purchases yet.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
</body>
</html>
